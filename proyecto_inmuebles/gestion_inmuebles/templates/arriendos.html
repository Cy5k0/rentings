{% extends 'layout/base.html' %}
{% load static %}

    
     {% block content %}
     <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
     
     <h1>Búsqueda de Ciudades</h1>
     <form action="" method="post">
        <input type="text" id="search-box" placeholder="Escribe el nombre de una ciudad...">
        <button type="submit" class="btn btn-primary btn-lg">
            Buscar
          </button>
     </form>
     <div id="resultados"></div>
     <script>
        $(document).ready(function() {
            // Al escribir en el input, realiza la búsqueda AJAX
            $('#search-box').on('keyup', function() {
                var query = $(this).val();
                
                // Solo realizar la búsqueda si hay al menos 2 caracteres
                if (query.length > 3) {
                    $.ajax({
                        url: '{% url "buscar_ciudades" %}',
                        data: {
                            'q': query
                        },
                        dataType: 'json',
                        success: function(data) {
                            var resultados = $('#resultados');
                            resultados.empty();
                            if (data.resultados.length > 0) {
                                data.resultados.forEach(function(ciudad) {
                                    resultados.append(
                                        '<div>' + 
                                            '<strong>' + ciudad.nombre + '</strong>, ' + 
                                            ciudad.estado + ', ' + 
                                            ciudad.pais + 
                                        '</div>'
                                    );
                                });
                            } else {
                                resultados.append('<div>No se encontraron resultados</div>');
                            }
                        },
                        error: function(xhr, status, error) {
                            console.log("Error en la solicitud AJAX:", error);
                        }
                    });
                } else {
                    $('#resultados').empty();
                }
            });
        });
    </script>   
     <!--<script src="{% static 'js/buscadorciudad.js' %}"></script>--><!-- Incluye tu archivo JS -->
    {% endblock %}
